# DLC Manager

一个基于 Python 和 PySide6 的现代化 DLC 下载管理工具，支持高效异步下载和可视化进度管理。

## ✨ 功能特性

### 🚀 高性能下载
- **异步并发下载**：支持最多50个并发请求，大幅提升下载效率
- **智能批次处理**：根据文件数量动态调整批次大小（5-20个文件/批次）
- **断点续传**：支持下载失败后的自动重试机制（最多5次重试）
- **文件校验**：基于MD5校验确保文件完整性
- **智能跳过**：自动检测已存在文件，避免重复下载

### 🎨 现代化界面
- **响应式GUI**：基于PySide6构建，支持现代化界面设计
- **实时进度**：可视化显示整体进度和单文件下载进度
- **状态管理**：直观显示文件状态（待下载/下载中/完成/失败）
- **日志系统**：实时显示下载日志和错误信息
- **自定义样式**：支持QSS样式表，提供美观的用户界面

### 📊 数据管理
- **JSON数据源**：读取BigFilesMD5s.json文件，展示所有DLC条目
- **状态持久化**：支持下载状态的保存和恢复
- **过滤搜索**：支持按文件名、状态等条件过滤
- **批量操作**：支持全选、批量下载等操作

### ⚙️ 配置优化
- **参数可调**：支持自定义并发数、超时时间、重试次数等
- **性能优化**：智能调整下载参数以适应不同网络环境
- **连接池管理**：优化HTTP连接复用，提升下载效率

## 📋 系统要求

- Python 3.8+
- PySide6 6.7.0+
- 支持的操作系统：Windows、macOS、Linux

## 🛠️ 安装与运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行应用

**方式一：直接运行主程序**
```bash
python main.py
```

**方式二：使用启动脚本**
```bash
python run.py
```

## 📁 项目结构

```
dlc_manager/
├── core/                      # 核心功能模块
│   ├── downloader.py         # 异步下载器
│   ├── models.py             # 数据模型定义
│   ├── persistence.py        # 状态持久化
│   └── __init__.py
├── ui/                        # 用户界面模块
│   ├── main_window.py        # 主窗口界面
│   ├── file_table_model.py   # 文件表格模型
│   └── __init__.py
├── resources/                 # 资源文件
│   └── style.qss             # 界面样式表
├── tests/                     # 测试套件
│   ├── test_core.py          # 核心功能测试
│   ├── test_download.py      # 下载功能测试
│   ├── test_gui.py           # GUI测试
│   └── run_tests.py          # 测试运行器
├── main.py                    # 主程序入口
├── run.py                     # 启动脚本
├── requirements.txt           # 项目依赖
└── README.md                  # 项目文档
```

## 🎯 使用流程

1. **启动应用**
   ```bash
   python main.py
   ```

2. **加载数据源**
   - 点击"加载文件映射"按钮
   - 选择 `BigFilesMD5s.json` 文件

3. **设置下载目录**
   - 点击"选择下载目录"
   - 选择文件保存位置

4. **配置下载参数**（可选）
   - 并发请求数：1-50（默认50）
   - 超时时间：30-300秒（默认120秒）
   - 批次大小：5-50（默认20）
   - 重试次数：1-10（默认5）

5. **选择下载文件**
   - 支持单选、多选和全选
   - 可按状态过滤文件列表

6. **开始下载**
   - 点击"开始下载"按钮
   - 实时查看下载进度和日志

## 🧪 运行测试

```bash
# 运行所有测试
python tests/run_tests.py

# 运行特定测试
python -m pytest tests/test_download.py -v
```

## ⚡ 性能优化

### 下载性能
- **并发优化**：支持最多50个并发连接
- **连接池**：复用HTTP连接，减少建立连接的开销
- **分块下载**：使用16KB分块大小平衡内存和性能
- **智能重试**：失败后自动重试，重试间隔0.5秒

### 内存优化
- **流式下载**：大文件采用流式处理，控制内存使用
- **批次处理**：分批处理文件，避免一次性加载过多任务
- **异步IO**：使用aiofiles进行异步文件操作

### 网络优化
- **DNS缓存**：启用DNS缓存，减少域名解析时间
- **Keep-Alive**：保持连接30秒，复用TCP连接
- **智能超时**：分层超时设置，平衡稳定性和效率

## 🔧 配置说明

### 下载配置参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `concurrent_requests` | 50 | 最大并发请求数 |
| `timeout` | 120 | 请求超时时间（秒） |
| `batch_size` | 20 | 批次处理大小 |
| `max_retries` | 5 | 最大重试次数 |
| `retry_delay` | 0.5 | 重试间隔（秒） |
| `chunk_size` | 16384 | 下载块大小（字节） |
| `connection_limit` | 100 | 连接池大小 |

### 文件状态说明

- **待下载**：等待下载的文件
- **下载中**：正在下载的文件
- **已完成**：下载成功的文件
- **失败**：下载失败的文件
- **已跳过**：已存在因此跳过的文件

## 🐛 故障排除

### 常见问题

1. **下载速度慢**
   - 检查网络连接
   - 适当降低并发数
   - 增加超时时间

2. **下载失败较多**
   - 检查文件映射JSON格式
   - 确认网络连接稳定
   - 增加重试次数

3. **界面无响应**
   - 检查是否有大量文件需要处理
   - 重启应用程序

### 日志位置

应用运行时的详细日志会显示在界面右侧的日志面板中，包括：
- 下载进度信息
- 错误和警告消息
- 性能统计数据

## 📄 许可证

本项目采用开源许可证，详见LICENSE文件。

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📞 支持

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件反馈

---

**DLC Manager** - 让DLC下载变得简单高效！ 🚀